###
### Build file template
###
#### See builder file for information about available functions and
#### variables.
####
#### If you don't need to edit one or more of the following functions,
#### feel free to remove them.
####
#### NOTE: Set LIBRARY=yes only if this package provides shared libraries
#### NOTE: If CACHE_EXTENSION doesn't need to be changed, it can be removed
#### NOTE: Set BUILD_FAST to true for small packages to build them in /tmp (this assumes /tmp is on tmpfs or such)
####

PACKAGE_NAME=""
PACKAGE_DESCRIPTION=""
PROJECT_URL=""
CACHE_EXTENSION=".tar.xz"
PACKAGE_URL="${PACKAGE_NAME}${CACHE_EXTENSION}"
BUILD_FAST=yes
LIBRARY=no

function download() {
  download_file "$PACKAGE_URL" "$PACKAGE_PATH"
}

function build() {
  require "$PACKAGE_PATH"

  extract_tar "$PACKAGE_PATH" "$BUILD_DIR"

  local BDIR="$BUILD_DIR/build"
  execute mkdir -p "$BDIR"

  pushd "$BDIR" >/dev/null
  ../$PACKAGE_NAME/configure CFLAGS="-I$ENV_DIR/usr/include" --prefix=/usr --sysconfdir=/etc --localstatedir=/var --disable-rpath && assert_last
  execute make -j$(($N_CPUS+1))
  make DESTDIR="$INSTALL_DIR" install && assert_last
  popd >/dev/null
}

function pack() {
  execute $(dirname "$0")/pack "$STAGE" "$PACKAGE_NAME"
  execute $(dirname "$0")/toenv "$STAGE" "$PACKAGE_NAME"
  [[ "$LIBRARY" = yes ]] && execute ldconfig -r "${ENV_DIR}"
}

function info() {
  echo -e "$PACKAGE_NAME: $PACKAGE_DESCRIPTION\n\t$PROJECT_URL\n"
}
